---
title: "Singapore HDB Resale Flat Prices for 1990 - 2022"
output: 
  github_document:
    toc: TRUE
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir = "C:/Users/iylia.hutta/OneDrive - Meltwater/Desktop/Data Stuff/Singapore HDB Flat Resale Prices")
```

```{r packages, include = FALSE}
library(tidyverse)
library(readr)
```


## Introduction

As a millenial growing up in Singapore and starting out in my first job, one of my life's goals is to own a house on this little red dot with my life partner (*read: wife*). 

Here in [Singapore](https://en.wikipedia.org/wiki/Singapore), there are generally [two ways](https://www.propertyguru.com.sg/property-guides/the-different-types-of-housing-in-singapore-9916) to do this:

- [Public Housing](https://www.hdb.gov.sg/about-us/our-role/public-housing-a-singapore-icon)
  - Brand new Built-to-Order (BTO) Flats (or apartments)
  - Resale Flats
- Private Housing (e.g., condominiums, landed property, etc.)

Whilst BTOs tend to be the choice of most young Singaporean couples, my current and potential future situation may push my partner and I to look towards resale flats to meet our housing needs. As such, I set forth on this project that will focus on resale flats under the Housing & Development Board (HDB).

This project therefore seeks to analyse the prices of Singapore's HDB Resale Flats for the years of 1990 - 2022. Data was obtained from Kaggle, [(1)](https://www.kaggle.com/datasets/syrahmadi/resale-hdb-flat-prices-2000-2022) and [(2)](https://www.kaggle.com/datasets/chngyuanlongrandy/hdb-prices-with-closest-mrt-distance), which were sourced from GovTech's open data portal, [data.gov.sg](https://data.gov.sg/dataset/resale-flat-prices).

```{r import, message = FALSE, echo = FALSE}
#import data as objects
nineties_data <- read_csv("C:/Users/iylia.hutta/OneDrive - Meltwater/Desktop/Data Stuff/Singapore HDB Flat Resale Prices/Data/resale-flat-prices-based-on-approval-date-1990-1999.csv")
feb2012_data <- read_csv("C:/Users/iylia.hutta/OneDrive - Meltwater/Desktop/Data Stuff/Singapore HDB Flat Resale Prices/Data/resale-flat-prices-based-on-approval-date-2000-feb-2012.csv")
dec2014_data <- read_csv("C:/Users/iylia.hutta/OneDrive - Meltwater/Desktop/Data Stuff/Singapore HDB Flat Resale Prices/Data/resale-flat-prices-based-on-registration-date-from-mar-2012-to-dec-2014.csv")
dec2016_data <- read_csv("C:/Users/iylia.hutta/OneDrive - Meltwater/Desktop/Data Stuff/Singapore HDB Flat Resale Prices/Data/resale-flat-prices-based-on-registration-date-from-jan-2015-to-dec-2016.csv")
latest_data <- read_csv("C:/Users/iylia.hutta/OneDrive - Meltwater/Desktop/Data Stuff/Singapore HDB Flat Resale Prices/Data/resale-flat-prices-based-on-registration-date-from-jan-2017-onwards.csv")
```


## Data Exploration

First, we will examine the data to understand its structure and contents.

```{r data exploration, echo = FALSE}
head(nineties_data)
head(feb2012_data)
head(dec2014_data)
head(dec2016_data)
head(latest_data)
```

From these, we see that the data structure is generally similar. The only difference being that the "Jan 2015 - Dec 2016" and "Jan 2017 onwards" data consists of an extra column `remaining_lease`, indicating the remaining years of lease for the houses in the datasets. For the purpose of this project then, we will be dropping this column to maintain data uniformity.

```{r drop excess columns, include = FALSE}
dec2016_data <- dec2016_data %>% 
  select(!remaining_lease)

head(dec2016_data)

latest_data <- latest_data %>% 
  select(!remaining_lease)

head(latest_data)
```

```{r union datasets, include = FALSE}
resale_data <- bind_rows(nineties_data,feb2012_data,dec2014_data,dec2016_data,latest_data)

head(resale_data)
```

Now that the data is similar, we can combine the datasets together. Looking into the dataset, we see that the `storey_range` variable has varied values, which we will be renaming into a new variable called `storeys`.

However, before we create the new variable, it would be helpful to understand the range of storey ranges among the resale flats and create a new variable to categorise them. 

Even in 2022, very few resale flats have more than 12 to 15 floors, hence, everything above the 9th floor will be tagged as *"high"*.

```{r storey_ranges, warning = FALSE, message = FALSE, echo = FALSE, fig.align = "center"}
#examine the values in storey_range for each year period
resale_data %>% 
  group_by(storey_range) %>% 
  summarise(count = n()) %>% 
  ggplot(aes(x = storey_range, y = count)) +
  geom_col() +
  coord_flip() +
  labs(y = "Count of flats",
       x = "Storey Ranges",
       title = "Number of flats per storey range in 1990 to 2022")
```

```{r relabel storey_ranges, include = FALSE}
#create new variable 
resale_data <- resale_data %>% 
  mutate(storeys = factor(case_when(
    storey_range == "01 TO 03" | storey_range == "01 TO 05" | storey_range == "04 TO 06" ~ "low",
    storey_range == "06 TO 10" | storey_range == "07 TO 09" ~ "mid",
    TRUE ~ "high"
  ),
  levels = c("low", "mid", "high"))) %>% 
  relocate(storeys, .after = storey_range)

head(resale_data)
```

## Exploratory Data Analysis

Now that the data is cleaned, we can do some quick exploratory analyses.

First, we know that generally, HDB flat prices tend to vary by storey levels. We can visualise this layman assumption here:

```{r plot storeys and price, echo = FALSE, fig.align = "center"}
ggplot(resale_data, aes(x = storeys, y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Storeys",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by Storey Levels") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200))
```

Although the variation and range of resale flat prices are relatively the same, the median prices for each of the storey categories seem to fit this assumption. That is, HDB flats on the lower levels generally tend to cost less than those on the higher levels.

One possible explanation for near similar variations and ranges could be the scope of the dataset, which covers approximately 30 years' worth of data. Furthermore, the above chart does not take into account the HDB town, which, as most Singaporeans know, also influences the prices of flats.

Let's examine the relationship between HDB towns and prices next:

```{r plot towns and price, echo = FALSE, fig.align = "center"}
ggplot(resale_data, aes(x = reorder(town, resale_price, median), y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Towns",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by HDB Towns") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200))
```

It is therefore evident that HDB resale flat prices do vary by their towns.

At this point, as mentioned above, the range of data is still massive with about 871,671 observations. For ease of and more focused analyses, we will narrow down the dataset by three conditions:

- Apartments from 2010 onwards (because we want newer houses and buildings)
- Apartments of at least 4-room and not multi-generation (so that we have a flat that is big enough to house at least 2 children)
- Apartments located on "mid" or "high" storeys (as we simply prefer being higher up and for the higher resale value over time)

```{r create year variable, include = FALSE}
resale_data <- resale_data %>% 
  mutate(year = as.integer(str_sub(month, end = 4))) %>% 
  relocate(year, .after = month)
```

```{r clean flat_type data, include = FALSE}
resale_data %>% 
  group_by(flat_type) %>% 
  summarise(n())

resale_data <- resale_data %>% 
  mutate(flat_type2 = factor(case_when(
    flat_type == "1 ROOM" ~ "1-room",
    flat_type == "2 ROOM" ~ "2-room",
    flat_type == "3 ROOM" ~ "3-room",
    flat_type == "4 ROOM" ~ "4-room",
    flat_type == "5 ROOM" ~ "5-room",
    flat_type == "EXECUTIVE" ~ "Executive",
    TRUE ~ "Others"
  ),
  levels = c("1-room", "2-room", "3-room", "4-room", "5-room", "Executive", "Others"))) %>% 
  relocate(flat_type2, .after = flat_type)
  
```

```{r filter data, echo = FALSE}
filtered_data <- resale_data %>% 
  filter(year >= 2010,
         flat_type2 == c("4-room", "5-room", "Executive"),
         storeys != "low")

head(filtered_data)
```

This gives us a dataset with 38,695 observations - something much easier to work with and relatively more reflective of current trends, considering the recency of the data.

### Analyses with filtered dataset

Here, we repeat the analyses from the previous section using the filtered dataset.

```{r plot storeys/towns and price with filtered data, echo = FALSE, fig.show="hold", out.width="50%"}
ggplot(filtered_data, aes(x = storeys, y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Storeys",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by Storey Levels") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200))

ggplot(filtered_data, aes(x = reorder(town, resale_price, median), y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Towns",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by HDB Towns") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200))
```

```{r compare median prices of storeys, include = FALSE}
median_price_high <- filtered_data %>% 
  filter(storeys == "high") %>% 
  summarise(median(resale_price)) %>% 
  pull()

median_price_mid <- filtered_data %>% 
  filter(storeys == "mid") %>% 
  summarise(median(resale_price)) %>% 
  pull()

median_diff <- format((median_price_high - median_price_mid),
                      big.mark   = ",",   big.interval = 3L,
                      scientific = FALSE)
```

We also add another analysis:

```{r plot flat type and price with filtered data, echo = FALSE, fig.align = "center"}
ggplot(filtered_data, aes(x = flat_type2, y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Flat Type",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by Flat Types") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200))
```

We can make three observations here:

For HDB Resale Flats sold from 2010 onwards,

1. Apartments on higher floors (i.e., at least 11th floor) tend to be priced SGD `r median_diff` more than those on middle floors (i.e., 6th to 10th floors)
2. Apartments in the areas nearer to the Central Business District (CBD) area of Singapore tend to be priced more than those further away, with those in mature estates priced higher than those in non-mature estates (see [here](https://www.propertyguru.com.sg/property-guides/non-mature-vs-mature-bto-55760) for list of such estates)
3. Apartments with larger flat types tend to be priced higher than relatively smaller ones


Another interesting observation is with the spread of resale prices by HDB towns.

Let's take a look at both the unfiltered (left) and filtered (right) data visualisations side by side:

```{r plot towns and price side, echo = FALSE, fig.show="hold", out.width="50%"}
ggplot(resale_data, aes(x = reorder(town, resale_price, median), y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = "Towns",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by HDB Towns for 1990 to 2022") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200)) +
  theme(plot.title = element_text(size = 12))

ggplot(filtered_data, aes(x = reorder(town, resale_price, median), y = resale_price/1000)) +
  geom_boxplot() +
  coord_flip() +
  labs(x = " ",
       y = "Prices (thousands; SGD)",
       title = "Spread of HDB Resale Flat Prices by HDB Towns for 2010 to 2022") +
  scale_y_continuous(breaks = seq(0, 1500, by = 200)) +
  theme(plot.title = element_text(size = 12))
```